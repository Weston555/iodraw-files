```mermaid
--- ### Horizontal Diagram (Left-to-Right Flow) ```mermaid flowchart LR A[数据加载和预处理
- 加载 CSV 股票数据
- 加载 LSTM 预测] B[投资组合优化
- 计算每日回报
- 年化回报和协方差
- **关键公式：**
Rₚ=Σ(w×μ)
σₚ=√(wᵀ-Cov-w)
S=(Rₚ-rf)/σₚ)C[Portfolio Selection
- Choose portfolio type (Max Sharpe or Min Volatility)
- Filter assets by weight threshold] D[Trading Environment Setup
- Construct multi-factor state
(Return, RSI, volatility, predictions. Trend)
-初始化资产
、趋势）
- 初始化投资组合权重] E[PPO 训练与交易模拟
- 训练 PPO 模型
- 执行模拟并记录交易] F[评估与可视化
- 计算性能指标（最终回报、夏普比率、最大缩水）
- 绘制累计回报并注释分配] G[保存与导出结果
- 导出 CSV 交易日志、TXT 摘要和图片] A --> B B --> CA --> B B --> C C --> D D --> E E --> F F --> G ``` 
```