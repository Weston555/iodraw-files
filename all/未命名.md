```mermaid
flowchart LR
    A[Data Loading & Preprocessing<br/>- Load CSV files & LSTM predictions] --> B[Portfolio Optimization<br/>Expected Return: Rₚ = Σ(w * μ)<br/>Volatility: σₚ = √(wᵀ · Cov · w)<br/>Sharpe Ratio: S = (Rₚ - rf) / σₚ]
    B --> C[Portfolio Selection<br/>- Choose portfolio type (Max Sharpe or Min Volatility)<br/>- Filter stocks by weight threshold]
    C --> D[Trading Environment Setup<br/>- Construct multi-factor state (returns, RSI, volatility, prediction, trend)<br/>- Initialize portfolio weights]
    D --> E[PPO Training & Trading Simulation<br/>- Train PPO model<br/>- Log transactions & weight adjustments]
    E --> F[Evaluation & Visualization<br/>- Compute Final Return, Sharpe Ratio, Max Drawdown<br/>- Plot cumulative returns with annotated initial & final weights]
    F --> G[Save & Export Results<br/>- Export CSV, TXT summaries, and images]

```