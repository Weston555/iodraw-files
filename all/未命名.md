```mermaid
flowchart LR
    A[Data Loading & Preprocessing<br/>\n• Load CSV files<br/>\n• Load LSTM prediction files]
    B[Portfolio Optimization<br/>\n• Expected Return: Rₚ = Σ(w × μ)<br/>\n• Volatility: σₚ = √(wᵀ · Cov · w)<br/>\n• Sharpe Ratio: S = (Rₚ - rf) / σₚ]
    C[Portfolio Selection<br/>\n• Choose portfolio type (Max Sharpe/Min Volatility)<br/>\n• Filter stocks by weight threshold]
    D[Trading Environment Setup<br/>\n• Build multi-factor state (returns, RSI, volatility, prediction, trend)<br/>\n• Initialize portfolio weights]
    E[PPO Training & Trading Simulation<br/>\n• Train PPO model<br/>\n• Log portfolio transactions]
    F[Evaluation & Visualization<br/>\n• Compute Final Return, Sharpe Ratio, Max Drawdown<br/>\n• Plot cumulative returns with annotated weights]
    G[Save & Export Results<br/>\n• Export CSV logs, summary TXT, and images]
    
    A --> B
    B --> C
    C --> D
    D --> E
    E --> F
    F --> G

```